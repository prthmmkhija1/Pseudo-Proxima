# Migration Guide: v0.1.x to v0.2.x

This guide covers migrating your Proxima installation and code from version 0.1.x to 0.2.x.

## Overview

Version 0.2 introduces significant improvements including:

- Unified backend interface
- Enhanced plugin system
- Web API (FastAPI)
- Improved configuration management
- Better error handling

## Breaking Changes

### 1. Backend Interface Changes

**Before (v0.1):**
```python
from proxima.backends import CirqBackend

backend = CirqBackend()
result = backend.execute(circuit, shots=1000)
```

**After (v0.2):**
```python
from proxima.backends import get_backend

backend = get_backend("cirq")
result = backend.run(circuit, shots=1000)
```

### 2. Configuration Format Changes

**Before (v0.1):** YAML-only configuration
```yaml
# config.yaml
backend: cirq
shots: 1000
```

**After (v0.2):** TOML preferred, YAML still supported
```toml
# proxima.toml
[simulation]
backend = "cirq"
shots = 1000

[backends.cirq]
precision = "double"
```

### 3. Result Object Changes

**Before (v0.1):**
```python
result.counts  # Dict[str, int]
result.time    # float
```

**After (v0.2):**
```python
result.counts          # Dict[str, int]
result.execution_time  # float
result.metadata        # Dict[str, Any]
result.backend         # str
```

### 4. Plugin System Changes

**Before (v0.1):**
```python
# Custom exporter
class MyExporter:
    def export(self, data):
        return str(data)
```

**After (v0.2):**
```python
from proxima.plugins.base import ExporterPlugin

class MyExporter(ExporterPlugin):
    name = "my-exporter"
    version = "1.0.0"
    description = "My custom exporter"
    supported_formats = ["txt"]
    
    def export(self, data, **options):
        return str(data)
```

## Migration Steps

### Step 1: Update Dependencies

```bash
pip install --upgrade proxima-agent>=0.2.0
```

### Step 2: Update Configuration Files

1. Convert YAML to TOML (optional but recommended):

```bash
proxima config convert config.yaml proxima.toml
```

2. Or update YAML to new format:

```yaml
# Old format
backend: cirq
shots: 1000

# New format
simulation:
  backend: cirq
  shots: 1000

backends:
  cirq:
    precision: double
```

### Step 3: Update Backend Usage

Replace direct backend instantiation:

```python
# Old
from proxima.backends.cirq import CirqBackend
backend = CirqBackend(precision="double")

# New
from proxima.backends import get_backend
backend = get_backend("cirq", precision="double")
```

### Step 4: Update Result Handling

```python
# Old
print(f"Time: {result.time}")

# New
print(f"Time: {result.execution_time}")
```

### Step 5: Update Custom Plugins

1. Inherit from appropriate base class
2. Add required metadata properties
3. Implement `initialize()` and `shutdown()` methods

```python
from proxima.plugins.base import AnalyzerPlugin, PluginContext

class MyAnalyzer(AnalyzerPlugin):
    name = "my-analyzer"
    version = "1.0.0"
    description = "My custom analyzer"
    analysis_types = ["custom"]
    
    def initialize(self, context: PluginContext) -> None:
        self._context = context
    
    def analyze(self, data, **options):
        # Your analysis logic
        return {"result": "analyzed"}
    
    def shutdown(self) -> None:
        pass
```

### Step 6: Update CLI Commands

Some CLI commands have been renamed:

| Old Command | New Command |
|-------------|-------------|
| `proxima run` | `proxima simulate` |
| `proxima config show` | `proxima config list` |
| `proxima backend list` | `proxima backends` |

## Deprecated Features

The following features are deprecated and will be removed in v0.3:

| Feature | Replacement |
|---------|-------------|
| `Backend.execute()` | `Backend.run()` |
| `result.time` | `result.execution_time` |
| YAML-only config | TOML configuration |
| `proxima run` | `proxima simulate` |

## Compatibility Mode

For gradual migration, enable compatibility mode:

```toml
# proxima.toml
[compatibility]
v01_mode = true
```

This enables:
- Old method names as aliases
- Old result property names
- YAML configuration without warnings

## Troubleshooting

### Import Errors

If you see `ImportError: cannot import name 'CirqBackend'`:

```python
# Replace
from proxima.backends.cirq import CirqBackend

# With
from proxima.backends import get_backend
backend = get_backend("cirq")
```

### Configuration Errors

If you see `ConfigurationError: Unknown key 'backend'`:

Your configuration needs to be updated to the new nested format. See Step 2 above.

### Plugin Registration Errors

If you see `PluginError: Missing required property 'name'`:

Your plugin needs to be updated to include required metadata. See Step 5 above.

## Getting Help

- Documentation: https://proxima.readthedocs.io/migration/
- GitHub Issues: https://github.com/yourusername/proxima/issues
- Discord: https://discord.gg/proxima

## Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for detailed changes.
